{"version":3,"sources":["components/common/Gap/index.tsx","utils/compose.ts","components/business/ArticleDetailButtonComponent/index.tsx"],"names":["Gap","props","height","size","style","width","clear","compose","funcs","length","arg","reduce","a","b","Text","error","ArticleDetailButtonComponent","inject","observer","handleCancel","history","replace","routeMapPath","article","home","handleSubmitContent","articleDetailStore","detail","changeDetail","validError","errorMsg","draftDetail","title","intro","tags","markdown","renderType","trim","push","key","EArticleEditError","titleError","value","introError","tagError","EArticleRenderType","richText","toText","contentError","errMsg","join","content","htmlContent","toHTML","rawString","toRAW","EArticleDetailKey","richTextHtml","richTextRaw","storage","remove","ARTICLE_CACHE_KEY","this","type","span","align","justify","onClick","Component","withRouter"],"mappings":"gHAAA,oBA6BeA,IAvBoB,SAAAC,GAClC,IAAIC,EAAS,EAEb,OAAQD,EAAME,MACb,IAAK,KACJD,EAAS,EACT,MACD,IAAK,KACJA,EAAS,GACT,MACD,IAAK,KACJA,EAAS,GACT,MACD,IAAK,KACJA,EAAS,GACT,MACD,QACCA,EAAS,EAGX,OAAO,2BAAOE,MAAO,CAAEF,SAAQG,MAAO,OAAQC,MAAO,Y,iCCmBvC,SAASC,IAA+B,IAAD,uBAAnBC,EAAmB,yBAAnBA,EAAmB,gBACrD,OAAqB,IAAjBA,EAAMC,OAEF,SAAIC,GAAJ,OAAeA,GAGF,IAAjBF,EAAMC,OACFD,EAAM,GAGPA,EAAMG,QAAO,SAACC,EAAGC,GAAJ,OAAU,kBAAkBD,EAAEC,EAAC,WAAD,kBArDnD,mC,iQCoBQC,E,IAAAA,KACAC,E,IAAAA,MAUFC,EAFLC,YAAO,qB,GACPC,Y,6MAIAC,aAAe,WACd,EAAKlB,MAAMmB,QAAQC,QAAQC,IAAaC,QAAQC,O,EAGjDC,oBAAsB,WAAO,IAAD,EACkB,EAAKxB,MAAMyB,mBAAhDC,EADmB,EACnBA,OAAQC,EADW,EACXA,aAAcC,EADH,EACGA,WAE9B,GAAIF,EAAQ,CACX,IAAMG,EAA0B,GACxBC,EAA0DJ,EAA1DI,YAAaC,EAA6CL,EAA7CK,MAAOC,EAAsCN,EAAtCM,MAAOC,EAA+BP,EAA/BO,KAAMC,EAAyBR,EAAzBQ,SAAUC,EAAeT,EAAfS,WAkCnD,GAjCKJ,EAAMK,SACVP,EAASQ,KAAK,4BACdT,EAAW,CACVU,IAAKC,IAAkBC,WACvBC,OAAO,KAGJT,EAAMI,SACVP,EAASQ,KAAK,4BACdT,EAAW,CACVU,IAAKC,IAAkBG,WACvBD,OAAO,KAGJR,EAAKzB,SACTqB,EAASQ,KAAK,4BACdT,EAAW,CACVU,IAAKC,IAAkBI,SACvBF,OAAO,MAKPN,IAAeS,IAAmBV,WAAaA,EAASE,QACxDD,IAAeS,IAAmBC,WAAaf,EAAYgB,YAE5DjB,EAASQ,KAAK,4BACdT,EAAW,CACVU,IAAKC,IAAkBQ,aACvBN,OAAO,KAILZ,EAASrB,OAAQ,CACpB,IAAMwC,EAASnB,EAASoB,KAAK,UAK7B,YAJAnC,EAAM,CACLiB,MAAO,eACPmB,QAAQ,GAAD,OAAKF,EAAL,8BAOT,GAAIb,IAAeS,IAAmBC,SAAU,CAE/C,IAAMM,EAAcrB,EAAYsB,SAE1BC,EAAYvB,EAAYwB,QAC9B3B,EAAa,CACZW,IAAKiB,IAAkBC,aACvBf,MAAOU,IAERxB,EAAa,CACZW,IAAKiB,IAAkBE,YACvBhB,MAAOY,IAGUT,IAAmBV,SAGtCwB,IAAQC,OAAOC,O,wEAIP,IAECb,EACNc,KAAK7D,MAAMyB,mBADdX,MAASiC,aAEV,OACC,oCACEA,GAAgB,kBAAClC,EAAD,CAAMiD,KAAK,UAAX,oDACjB,kBAAC,IAAD,CAAK5D,KAAK,OACV,uBAAK6D,KAAM,IACV,uBAAKD,KAAK,OAAOE,MAAM,SAASC,QAAQ,OACvC,uBAAQ/D,KAAK,QAAQgE,QAASL,KAAK3C,cAAnC,gBADD,iBAKC,uBACC4C,KAAK,UACL5D,KAAK,QACLgE,QAASL,KAAKrC,qBAHf,kBAQF,kBAAC,IAAD,CAAKtB,KAAK,Y,GApG6BiE,e,MA0G5B7D,sBAAwB8D,IAAxB9D,CACdS","file":"static/js/ArticleDetailButtonComponent.91300ede.chunk.js","sourcesContent":["import React, { FC } from 'react';\n\nexport type CommonGapPropType = {\n\tsize?: 'sm' | 'md' | 'lg' | 'xl';\n};\n\nconst Gap: FC<CommonGapPropType> = props => {\n\tlet height = 0;\n\n\tswitch (props.size) {\n\t\tcase 'sm':\n\t\t\theight = 8;\n\t\t\tbreak;\n\t\tcase 'md':\n\t\t\theight = 12;\n\t\t\tbreak;\n\t\tcase 'lg':\n\t\t\theight = 16;\n\t\t\tbreak;\n\t\tcase 'xl':\n\t\t\theight = 24;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\theight = 8;\n\t}\n\n\treturn <aside style={{ height, width: '100%', clear: 'both' }} />;\n};\n\nexport default Gap;\n","type Func<T extends any[], R> = (...a: T) => R;\n\n/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for the\n * resulting composite function.\n *\n * @param funcs The functions to compose.\n * @returns A function obtained by composing the argument functions from right\n *   to left. For example, `compose(f, g, h)` is identical to doing\n *   `(...args) => f(g(h(...args)))`.\n */\nexport default function compose(): <R>(a: R) => R;\n\nexport default function compose<F extends Function>(f: F): F;\n\n/* two functions */\nexport default function compose<A, T extends any[], R>(\n\tf1: (a: A) => R,\n\tf2: Func<T, A>,\n): Func<T, R>;\n\n/* three functions */\nexport default function compose<A, B, T extends any[], R>(\n\tf1: (b: B) => R,\n\tf2: (a: A) => B,\n\tf3: Func<T, A>,\n): Func<T, R>;\n\n/* four functions */\nexport default function compose<A, B, C, T extends any[], R>(\n\tf1: (c: C) => R,\n\tf2: (b: B) => C,\n\tf3: (a: A) => B,\n\tf4: Func<T, A>,\n): Func<T, R>;\n\n/* rest */\nexport default function compose<R>(\n\tf1: (a: any) => R,\n\t...funcs: Function[]\n): (...args: any[]) => R;\n\nexport default function compose<R>(...funcs: Function[]): (...args: any[]) => R;\n\nexport default function compose(...funcs: Function[]) {\n\tif (funcs.length === 0) {\n\t\t// infer the argument type so it is usable in inference down the line\n\t\treturn <T>(arg: T) => arg;\n\t}\n\n\tif (funcs.length === 1) {\n\t\treturn funcs[0];\n\t}\n\n\treturn funcs.reduce((a, b) => (...args: any) => a(b(...args)));\n}\n","import React, { Component, ComponentClass } from 'react';\n\nimport { RouteComponentProps, withRouter } from 'react-router-dom';\nimport { inject, observer } from 'mobx-react';\n\nimport { Button, Col, Row, Typography, Modal } from 'antd';\nimport Gap from '@/components/common/Gap';\n\nimport { StoreType } from '@/store/store';\n\nimport {\n\tEArticleDetailKey,\n\tEArticleEditError,\n\tEArticleRenderType,\n} from '@/store/ArticleDetailStore/article.enum';\n\nimport { ARTICLE_CACHE_KEY } from '@/utils/constant';\nimport compose from '@/utils/compose';\nimport { storage } from '@/utils/storage';\n\nimport { routeMapPath } from '@/route';\n\nconst { Text } = Typography;\nconst { error } = Modal;\n\nexport type ArticleDetailButtonComponentPropType = Pick<\n\tStoreType,\n\t'articleDetailStore'\n> &\n\tRouteComponentProps;\n\n@inject('articleDetailStore')\n@observer\nclass ArticleDetailButtonComponent extends Component<\n\tArticleDetailButtonComponentPropType\n> {\n\thandleCancel = () => {\n\t\tthis.props.history.replace(routeMapPath.article.home);\n\t};\n\n\thandleSubmitContent = () => {\n\t\tconst { detail, changeDetail, validError } = this.props.articleDetailStore;\n\t\t// 校验\n\t\tif (detail) {\n\t\t\tconst errorMsg: Array<string> = [];\n\t\t\tconst { draftDetail, title, intro, tags, markdown, renderType } = detail;\n\t\t\tif (!title.trim()) {\n\t\t\t\terrorMsg.push('文章标题');\n\t\t\t\tvalidError({\n\t\t\t\t\tkey: EArticleEditError.titleError,\n\t\t\t\t\tvalue: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!intro.trim()) {\n\t\t\t\terrorMsg.push('文章简介');\n\t\t\t\tvalidError({\n\t\t\t\t\tkey: EArticleEditError.introError,\n\t\t\t\t\tvalue: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!tags.length) {\n\t\t\t\terrorMsg.push('文章标签');\n\t\t\t\tvalidError({\n\t\t\t\t\tkey: EArticleEditError.tagError,\n\t\t\t\t\tvalue: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(renderType === EArticleRenderType.markdown && !markdown.trim()) ||\n\t\t\t\t(renderType === EArticleRenderType.richText && !draftDetail.toText())\n\t\t\t) {\n\t\t\t\terrorMsg.push('文章内容');\n\t\t\t\tvalidError({\n\t\t\t\t\tkey: EArticleEditError.contentError,\n\t\t\t\t\tvalue: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (errorMsg.length) {\n\t\t\t\tconst errMsg = errorMsg.join('，');\n\t\t\t\terror({\n\t\t\t\t\ttitle: '提示',\n\t\t\t\t\tcontent: `${errMsg}不能为空`,\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 虽然html字符串也可以用于持久化存储，但是对于比较复杂的富文本内容，在反复编辑的过程中，可能会存在格式丢失的情况\n\t\t\t// 比较标准的做法是在数据库中同时存储raw字符串和html字符串，分别用于再次编辑和前台展示。\n\t\t\tif (renderType === EArticleRenderType.richText) {\n\t\t\t\t// 将editorState数据转换成HTML字符串\n\t\t\t\tconst htmlContent = draftDetail.toHTML();\n\t\t\t\t// 将editorState数据转换成RAW字符串\n\t\t\t\tconst rawString = draftDetail.toRAW();\n\t\t\t\tchangeDetail({\n\t\t\t\t\tkey: EArticleDetailKey.richTextHtml,\n\t\t\t\t\tvalue: htmlContent,\n\t\t\t\t});\n\t\t\t\tchangeDetail({\n\t\t\t\t\tkey: EArticleDetailKey.richTextRaw,\n\t\t\t\t\tvalue: rawString,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (renderType === EArticleRenderType.markdown) {\n\t\t\t\tconsole.log(markdown);\n\t\t\t}\n\t\t\tstorage.remove(ARTICLE_CACHE_KEY);\n\t\t}\n\t};\n\n\trender() {\n\t\tconst {\n\t\t\terror: { contentError },\n\t\t} = this.props.articleDetailStore;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{contentError && <Text type=\"danger\">文章内容不能为空</Text>}\n\t\t\t\t<Gap size=\"lg\" />\n\t\t\t\t<Col span={24}>\n\t\t\t\t\t<Row type=\"flex\" align=\"middle\" justify=\"end\">\n\t\t\t\t\t\t<Button size=\"large\" onClick={this.handleCancel}>\n\t\t\t\t\t\t\t取消\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t&nbsp; &nbsp; &nbsp;\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\t\tsize=\"large\"\n\t\t\t\t\t\t\tonClick={this.handleSubmitContent}>\n\t\t\t\t\t\t\t提交\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Row>\n\t\t\t\t</Col>\n\t\t\t\t<Gap size=\"lg\" />\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default compose<ComponentClass>(withRouter)(\n\tArticleDetailButtonComponent,\n);\n"],"sourceRoot":""}