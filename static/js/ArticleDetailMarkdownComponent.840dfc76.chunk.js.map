{"version":3,"sources":["service/upload.ts","components/business/ArticleDetailContentComponent/markdown.tsx"],"names":["uploadFile","file","Promise","resolve","reject","destroy","loading","fileReader","FileReader","readAsDataURL","onload","e","target","result","url","title","name","objectId","Date","now","error","ArticleDetailMarkdownComponent","inject","observer","$vm","React","createRef","handleChange","value","props","articleDetailStore","validError","changeDetail","detail","key","EArticleEditError","contentError","renderType","EArticleRenderType","markdown","EArticleDetailKey","handleUploadFile","index","then","current","$img2Url","this","ref","onChange","addImg","placeholder","preview","subfield","toolbar","h1","h2","h3","h4","img","link","code","expand","undo","redo","Component"],"mappings":"sKAEaA,EAAa,SACzBC,GAMA,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC5B,IAAQC,UAER,IAAMC,EAAU,IAAQA,QAAQ,oCAAY,GACtCC,EAAa,IAAIC,WACvBD,EAAWE,cAAcR,GACzBM,EAAWG,OAAS,SAAAC,GACfA,EAAEC,QAAUD,EAAEC,OAAOC,OACxBV,EAAQ,CACPW,IAAKH,EAAEC,OAAOC,OACdE,MAAOd,EAAKe,KACZC,SAAUC,KAAKC,MAAQ,MAGxB,IAAQC,MAAR,UAAiBnB,EAAKe,KAAtB,yCACAZ,KAEDE,U,kJCLGe,EAFLC,YAAO,qB,GACPC,Y,6MAIAC,IAAMC,IAAMC,Y,EAEZC,aAAe,SAACC,GAAmB,IAAD,EACY,EAAKC,MAAMC,mBAAhDC,EADyB,EACzBA,WAAYC,EADa,EACbA,aAAcC,EADD,EACCA,OAClCF,EAAW,CACVG,IAAKC,IAAkBC,aACvBR,OAAQA,IAAe,OAANK,QAAM,IAANA,OAAA,EAAAA,EAAQI,cAAeC,IAAmBC,WAE5DP,EAAa,CACZE,IAAKM,IAAkBD,SACvBX,W,EAIFa,iBAAmB,SAACxC,EAAYyC,GAC/B1C,YAAWC,GAAM0C,MAAK,YAAqB,IAAlB7B,EAAiB,EAAjBA,IAAKC,EAAY,EAAZA,MAC7B,EAAKS,IAAIoB,QAAQC,SAAS9B,EAAOD,O,wEAIzB,IACDmB,EAAWa,KAAKjB,MAAMC,mBAAtBG,OAER,OACC,kBAAC,IAAD,CACCc,IAAKD,KAAKtB,IACVI,MAAK,OAAEK,QAAF,IAAEA,OAAF,EAAEA,EAAQM,SACfS,SAAUF,KAAKnB,aACfsB,OAAQH,KAAKL,iBACbS,YAAY,gDACZC,SAAS,EACTC,UAAU,EACVC,QAAS,CACRC,IAAI,EACJC,IAAI,EACJC,IAAI,EACJC,IAAI,EACJC,KAAK,EACLC,MAAM,EACNC,MAAM,EACNT,SAAS,EACTU,QAAQ,EAERC,MAAM,EACNC,MAAM,EAENX,UAAU,S,GAjD8BY,e,MAwD7B3C","file":"static/js/ArticleDetailMarkdownComponent.840dfc76.chunk.js","sourcesContent":["import { message } from 'antd';\n\nexport const uploadFile = (\n\tfile: File,\n): Promise<{\n\turl: string;\n\ttitle: string;\n\tobjectId: string;\n}> => {\n\treturn new Promise((resolve, reject) => {\n\t\tmessage.destroy();\n\t\t// 伪文件上传预览\n\t\tconst loading = message.loading('文件上传中...', 0);\n\t\tconst fileReader = new FileReader();\n\t\tfileReader.readAsDataURL(file);\n\t\tfileReader.onload = e => {\n\t\t\tif (e.target && e.target.result) {\n\t\t\t\tresolve({\n\t\t\t\t\turl: e.target.result as string,\n\t\t\t\t\ttitle: file.name,\n\t\t\t\t\tobjectId: Date.now() + '',\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmessage.error(`${file.name}文件上传失败`);\n\t\t\t\treject();\n\t\t\t}\n\t\t\tloading();\n\t\t};\n\t});\n};\n","import React, { Component, ComponentClass } from 'react';\n\nimport { inject, observer } from 'mobx-react';\n\nimport Editor from 'for-editor';\n\nimport { StoreType } from '@/store/store';\nimport {\n\tEArticleDetailKey,\n\tEArticleEditError,\n\tEArticleRenderType,\n} from '@/store/ArticleDetailStore/article.enum';\nimport { uploadFile } from '@/service/upload';\n\nexport type ArticleDetailMarkdownComponentPropType = Pick<\n\tStoreType,\n\t'articleDetailStore'\n>;\n\n@inject('articleDetailStore')\n@observer\nclass ArticleDetailMarkdownComponent extends Component<\n\tArticleDetailMarkdownComponentPropType\n> {\n\t$vm = React.createRef<any>();\n\n\thandleChange = (value: string) => {\n\t\tconst { validError, changeDetail, detail } = this.props.articleDetailStore;\n\t\tvalidError({\n\t\t\tkey: EArticleEditError.contentError,\n\t\t\tvalue: !value && detail?.renderType === EArticleRenderType.markdown,\n\t\t});\n\t\tchangeDetail({\n\t\t\tkey: EArticleDetailKey.markdown,\n\t\t\tvalue,\n\t\t});\n\t};\n\n\thandleUploadFile = (file: File, index: number) => {\n\t\tuploadFile(file).then(({ url, title }) => {\n\t\t\tthis.$vm.current.$img2Url(title, url);\n\t\t});\n\t};\n\n\trender() {\n\t\tconst { detail } = this.props.articleDetailStore;\n\n\t\treturn (\n\t\t\t<Editor\n\t\t\t\tref={this.$vm}\n\t\t\t\tvalue={detail?.markdown}\n\t\t\t\tonChange={this.handleChange}\n\t\t\t\taddImg={this.handleUploadFile}\n\t\t\t\tplaceholder=\"请输入文章内容...\"\n\t\t\t\tpreview={true}\n\t\t\t\tsubfield={true}\n\t\t\t\ttoolbar={{\n\t\t\t\t\th1: true, // h1\n\t\t\t\t\th2: true, // h2\n\t\t\t\t\th3: true, // h3\n\t\t\t\t\th4: true, // h4\n\t\t\t\t\timg: true, // 图片\n\t\t\t\t\tlink: true, // 链接\n\t\t\t\t\tcode: true, // 代码块\n\t\t\t\t\tpreview: true, // 预览\n\t\t\t\t\texpand: true, // 全屏\n\t\t\t\t\t/* v0.0.9 */\n\t\t\t\t\tundo: true, // 撤销\n\t\t\t\t\tredo: true, // 重做\n\t\t\t\t\t/* v0.2.3 */\n\t\t\t\t\tsubfield: true, // 单双栏模式\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default (ArticleDetailMarkdownComponent as unknown) as ComponentClass;\n"],"sourceRoot":""}