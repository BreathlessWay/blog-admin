{"version":3,"sources":["utils/parseSearch.ts","pages/ArticlePage/ArticleEditPage/index.tsx"],"names":["parseSearch","search","_search","replace","qs","parse","ArticleDetailTopComponent","lazy","ArticleDetailRichTextComponent","ArticleDetailMarkdownComponent","ArticleDetailButtonComponent","confirm","warning","ArticleEditPage","inject","allStore","articleDetailStore","tagStore","observer","time","startCache","setInterval","detail","props","title","intro","tags","status","renderType","markdown","draftDetail","_cacheTag","map","tag","objectId","filter","value","_cacheDetail","EArticleRenderType","richText","toText","toRAW","cache","id","articleId","data","storage","set","key","ARTICLE_CACHE_KEY","ARTICLE_CACHE_TIME","loadCache","articleCache","params","Number","length","item","includes","richTextRaw","setDetail","getData","createArticle","isEdit","isCreate","pathname","this","location","_this","routeMapPath","article","edit","content","okText","onOk","history","home","judgeCache","keyboard","maskClosable","onCancel","remove","window","clearInterval","resetError","cacheDetail","Boolean","join","get","create","Component"],"mappings":"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","file":"static/js/ArticleEditPage.99e3ba94.chunk.js","sourcesContent":["import qs from 'qs';\n\nexport const parseSearch = <T>(search: string): T | null => {\n\tconst _search = search.replace(/^\\?(.*)$/, '$1');\n\tif (_search) {\n\t\treturn qs.parse(_search);\n\t}\n\treturn null;\n};\n","import React, { Component, ComponentClass, lazy } from 'react';\n\nimport { inject, observer } from 'mobx-react';\n\nimport { Modal } from 'antd';\n\nimport { RouteComponentProps } from 'react-router-dom';\nimport { StoreType } from '@/store/store';\nimport { ArticleCacheType, ArticleDetailType } from '@/types/article';\n\nimport { EArticleRenderType } from '@/store/ArticleDetailStore/article.enum';\n\nimport { ARTICLE_CACHE_KEY, ARTICLE_CACHE_TIME } from '@/utils/constant';\nimport { parseSearch } from '@/utils/parseSearch';\nimport { storage } from '@/utils/storage';\n\nimport { routeMapPath } from '@/route';\n\nconst ArticleDetailTopComponent = lazy(() =>\n\timport(\n\t\t/* webpackChunkName: \"ArticleDetailTopComponent\" */ '@/components/business/ArticleDetailTopComponent'\n\t),\n);\n\nconst ArticleDetailRichTextComponent = lazy(() =>\n\timport(\n\t\t/* webpackChunkName: \"ArticleDetailRichTextComponent\" */ '@/components/business/ArticleDetailContentComponent/richText'\n\t),\n);\n\nconst ArticleDetailMarkdownComponent = lazy(() =>\n\timport(\n\t\t/* webpackChunkName: \"ArticleDetailMarkdownComponent\" */ '@/components/business/ArticleDetailContentComponent/markdown'\n\t),\n);\n\nconst ArticleDetailButtonComponent = lazy(() =>\n\timport(\n\t\t/* webpackChunkName: \"ArticleDetailButtonComponent\" */ '@/components/business/ArticleDetailButtonComponent'\n\t),\n);\n\nconst { confirm, warning } = Modal;\n\nexport type ArticleEditPagePropType = Pick<\n\tStoreType,\n\t'articleDetailStore' | 'tagStore'\n> &\n\tRouteComponentProps;\n\n@inject((allStore: StoreType) => ({\n\tarticleDetailStore: allStore.articleDetailStore,\n\ttagStore: allStore.tagStore,\n}))\n@observer\nclass ArticleEditPage extends Component<ArticleEditPagePropType> {\n\ttime: any = null;\n\n\tasync componentDidMount() {\n\t\tconst { pathname } = this.props.location;\n\t\tconst _this = this;\n\n\t\tif (pathname === routeMapPath.article.edit && !this.articleId) {\n\t\t\twarning({\n\t\t\t\ttitle: '提示',\n\t\t\t\tcontent: '编辑文章缺失文章id参数！',\n\t\t\t\tokText: '确定',\n\t\t\t\tonOk() {\n\t\t\t\t\t_this.props.history.replace(routeMapPath.article.home);\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tawait this.getData();\n\n\t\tif (this.judgeCache) {\n\t\t\tconfirm({\n\t\t\t\ttitle: '提示',\n\t\t\t\tcontent: '您似乎有上一次未保存的草稿，是否载入？',\n\t\t\t\tkeyboard: false,\n\t\t\t\tmaskClosable: false,\n\t\t\t\tonOk() {\n\t\t\t\t\t_this.loadCache();\n\t\t\t\t},\n\t\t\t\tonCancel() {\n\t\t\t\t\tstorage.remove(ARTICLE_CACHE_KEY);\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tstorage.remove(ARTICLE_CACHE_KEY);\n\t\tthis.startCache();\n\t}\n\n\tcomponentWillUnmount(): void {\n\t\twindow.clearInterval(this.time);\n\t\tthis.time = null;\n\t\tthis.props.articleDetailStore.resetError();\n\t}\n\n\tget judgeCache() {\n\t\tif (this.articleCache) {\n\t\t\tconst {\n\t\t\t\tid,\n\t\t\t\tdata: { title, intro, detail: cacheDetail, tags, renderType, status },\n\t\t\t} = this.articleCache;\n\t\t\tif (this.isCreate && id === 'create') {\n\t\t\t\treturn Boolean(title || intro || cacheDetail || tags.length);\n\t\t\t}\n\t\t\tif (this.isEdit && id === this.articleId) {\n\t\t\t\tconst { detail } = this.props.articleDetailStore;\n\t\t\t\tif (detail) {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttitle !== detail.title ||\n\t\t\t\t\t\tintro !== detail.intro ||\n\t\t\t\t\t\trenderType !== detail.renderType ||\n\t\t\t\t\t\tNumber(status) !== detail.status\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (detail.tags.map(tag => tag.objectId).join() !== tags.join()) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\trenderType === EArticleRenderType.markdown &&\n\t\t\t\t\t\tcacheDetail !== detail.markdown\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\trenderType === EArticleRenderType.richText &&\n\t\t\t\t\t\tcacheDetail !== detail.richTextRaw\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstartCache = () => {\n\t\tthis.time = setInterval(() => {\n\t\t\tconst { detail } = this.props.articleDetailStore;\n\t\t\tif (detail) {\n\t\t\t\tconst {\n\t\t\t\t\ttitle,\n\t\t\t\t\tintro,\n\t\t\t\t\ttags,\n\t\t\t\t\tstatus,\n\t\t\t\t\trenderType,\n\t\t\t\t\tmarkdown,\n\t\t\t\t\tdraftDetail,\n\t\t\t\t} = detail;\n\t\t\t\tconst _cacheTag = tags.map(tag => tag.objectId).filter(value => value);\n\t\t\t\tlet _cacheDetail = '';\n\t\t\t\tif (renderType === EArticleRenderType.richText) {\n\t\t\t\t\tif (draftDetail && draftDetail.toText()) {\n\t\t\t\t\t\t_cacheDetail = draftDetail.toRAW();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (renderType === EArticleRenderType.markdown) {\n\t\t\t\t\t_cacheDetail = markdown;\n\t\t\t\t}\n\t\t\t\tconst cache: ArticleCacheType = {\n\t\t\t\t\tid: this.articleId || 'create',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tintro,\n\t\t\t\t\t\ttags: _cacheTag as Array<string>,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t\trenderType,\n\t\t\t\t\t\tdetail: _cacheDetail,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tstorage.set({ key: ARTICLE_CACHE_KEY, value: cache });\n\t\t\t}\n\t\t}, ARTICLE_CACHE_TIME);\n\t};\n\n\tloadCache = () => {\n\t\tif (this.articleCache) {\n\t\t\tconst {\n\t\t\t\tdata: { title, intro, tags, renderType, status, detail },\n\t\t\t} = this.articleCache;\n\n\t\t\tconst params: ArticleDetailType = {\n\t\t\t\ttitle,\n\t\t\t\tintro,\n\t\t\t\ttags: [],\n\t\t\t\trenderType,\n\t\t\t\tstatus: Number(status),\n\t\t\t} as any;\n\t\t\tif (tags.length) {\n\t\t\t\tparams.tags = this.props.tagStore.tags.filter(\n\t\t\t\t\titem => item.objectId && tags.includes(item.objectId),\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (renderType === EArticleRenderType.richText) {\n\t\t\t\tparams.richTextRaw = detail;\n\t\t\t}\n\t\t\tif (renderType === EArticleRenderType.markdown) {\n\t\t\t\tparams.markdown = detail;\n\t\t\t}\n\n\t\t\tthis.props.articleDetailStore.setDetail(params);\n\t\t}\n\t\tthis.startCache();\n\t};\n\n\tgetData = () => {\n\t\tconst { createArticle } = this.props.articleDetailStore;\n\t\tif (this.isEdit) {\n\t\t}\n\t\tif (this.isCreate) {\n\t\t\tcreateArticle();\n\t\t}\n\t};\n\n\tget articleCache(): ArticleCacheType | null {\n\t\treturn storage.get(ARTICLE_CACHE_KEY);\n\t}\n\n\tget articleId() {\n\t\treturn parseSearch<{ id: string }>(this.props.location.search)?.id ?? null;\n\t}\n\n\tget isCreate() {\n\t\treturn this.props.location.pathname === routeMapPath.article.create;\n\t}\n\n\tget isEdit() {\n\t\tconst { search, pathname } = this.props.location;\n\t\treturn search && pathname === routeMapPath.article.edit;\n\t}\n\n\trender() {\n\t\tconst { detail } = this.props.articleDetailStore;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ArticleDetailTopComponent />\n\t\t\t\t{detail?.renderType === EArticleRenderType.richText && (\n\t\t\t\t\t<ArticleDetailRichTextComponent />\n\t\t\t\t)}\n\t\t\t\t{detail?.renderType === EArticleRenderType.markdown && (\n\t\t\t\t\t<ArticleDetailMarkdownComponent />\n\t\t\t\t)}\n\t\t\t\t<ArticleDetailButtonComponent />\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default (ArticleEditPage as unknown) as ComponentClass;\n"],"sourceRoot":""}